<!-- 下雪特效 Canvas -->
<canvas id="snow-canvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;"></canvas>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const canvas = document.getElementById('snow-canvas');
    const ctx = canvas.getContext('2d');
    
    let width, height;
    let particles = [];
    
    // 粒子配置 (你可以修改这些数值)
    const particleCount = 60; // 雪花数量，数值越大越密集
    const speed = 0.5;        // 下落速度
    const size = 2.5;         // 雪花最大尺寸
    
    // 调整画布大小
    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }
    
    // 初始化粒子
    function initParticles() {
        particles = [];
        for (let i = 0; i < particleCount; i++) {
            particles.push({
                x: Math.random() * width,
                y: Math.random() * height,
                r: Math.random() * size, // 半径
                d: Math.random() * particleCount, // 密度/视差因子
                a: Math.random() * 0.5 + 0.1 // 透明度
            });
        }
    }
    
    // 绘制粒子
    function draw() {
        ctx.clearRect(0, 0, width, height);
        
        // 设置雪花颜色 - 自动适配暗色/亮色模式
        // PaperMod 通常在 body 上使用 class="dark"
        const isDark = document.body.className.includes('dark');
        ctx.fillStyle = isDark ? 'rgba(255, 255, 255, 0.8)' : 'rgba(100, 100, 100, 0.5)';
        
        ctx.beginPath();
        for (let i = 0; i < particleCount; i++) {
            const p = particles[i];
            ctx.moveTo(p.x, p.y);
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2, true);
        }
        ctx.fill();
        update();
    }
    
    // 更新位置
    function update() {
        for (let i = 0; i < particleCount; i++) {
            const p = particles[i];
            
            // 下落逻辑
            p.y += Math.cos(p.d) + 1 + p.r / 2 * speed;
            p.x += Math.sin(0) * 2;
            
            // 边界检查，如果超出底部则重置到顶部
            if (p.x > width + 5 || p.x < -5 || p.y > height) {
                if (i % 3 > 0) { // 2/3 的雪花从顶部重新落下
                    particles[i] = {
                        x: Math.random() * width,
                        y: -10,
                        r: p.r,
                        d: p.d,
                        a: p.a
                    };
                } else {
                    // 如果是向右飘出，从左边回来
                    if (Math.sin(0) > 0) {
                        particles[i] = {
                            x: -5,
                            y: Math.random() * height,
                            r: p.r,
                            d: p.d,
                            a: p.a
                        };
                    } else {
                        particles[i] = {
                            x: width + 5,
                            y: Math.random() * height,
                            r: p.r,
                            d: p.d,
                            a: p.a
                        };
                    }
                }
            }
        }
        requestAnimationFrame(draw);
    }
    
    // 监听窗口大小变化
    window.addEventListener('resize', resize);
    
    // 启动
    resize();
    initParticles();
    draw();
});
</script>

<!-- 引入 medium-zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const zoom = mediumZoom('.post-content img', {
            margin: 24,       // 放大后距离屏幕边缘的距离
            background: '',   // 背景色我们用 CSS 控制（支持毛玻璃）
            scrollOffset: 0,  // 滚动多少距离就自动收回
        });

        // 适配 PaperMod 的暗黑模式切换
        const target = document.querySelector('body');
        const observer = new MutationObserver(() => {
            const isDark = target.classList.contains('dark');
            zoom.update({
                background: isDark ? 'rgba(28, 28, 30, 0.9)' : 'rgba(255, 255, 255, 0.9)'
            });
        });
        observer.observe(target, { attributes: true, attributeFilter: ['class'] });
    });
</script>


